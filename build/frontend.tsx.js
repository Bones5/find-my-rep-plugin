(()=>{"use strict";var e={338:(e,t,a)=>{var n=a(795);t.H=n.createRoot,n.hydrateRoot},795:e=>{e.exports=window.ReactDOM}},t={};const a=window.React;var n=function a(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,a),s.exports}(338);const r=({onFindReps:e,error:t,loading:n})=>{const[r,s]=(0,a.useState)(""),l=()=>{const t=r.trim();t&&e(t)};return(0,a.createElement)("div",{className:"find-my-rep-step step-postcode"},(0,a.createElement)("h3",null,"Find Your Representatives"),(0,a.createElement)("label",{htmlFor:"postcode-input"},"Enter your postcode:"),(0,a.createElement)("input",{type:"text",id:"postcode-input",className:"postcode-input",placeholder:"e.g. SW1A 1AA",value:r,onChange:e=>s(e.target.value),onKeyPress:e=>{"Enter"===e.key&&l()},disabled:n}),(0,a.createElement)("button",{className:"button button-primary find-reps-btn",onClick:l,disabled:n},"Find Representatives"),t&&(0,a.createElement)("div",{className:"error-message",style:{display:"block"}},t))},s=({representatives:e,geographicInfo:t,onContinue:n})=>{const[r,s]=(0,a.useState)(new Set);return(0,a.createElement)("div",{className:"find-my-rep-step step-select"},(0,a.createElement)("h3",null,"Select Representatives to Contact"),t&&(0,a.createElement)("div",{className:"geographic-info"},t.area&&(0,a.createElement)("div",{className:"geographic-item"},(0,a.createElement)("strong",null,"Area:")," ",t.area),t.ward&&(0,a.createElement)("div",{className:"geographic-item"},(0,a.createElement)("strong",null,"Ward:")," ",t.ward),t.westminster_constituency&&(0,a.createElement)("div",{className:"geographic-item"},(0,a.createElement)("strong",null,"Westminster Constituency:")," ",t.westminster_constituency),t.devolved_constituency&&(0,a.createElement)("div",{className:"geographic-item"},(0,a.createElement)("strong",null,"Devolved Constituency:")," ",t.devolved_constituency)),(0,a.createElement)("div",{className:"representatives-list"},e.map((e,t)=>{const n=e.email||`rep-${t}`;return(0,a.createElement)("div",{key:n,className:"representative-item"},(0,a.createElement)("input",{type:"checkbox",id:`rep-${t}`,checked:r.has(t),onChange:()=>(e=>{const t=new Set(r);t.has(e)?t.delete(e):t.add(e),s(t)})(t)}),(0,a.createElement)("label",{htmlFor:`rep-${t}`},(0,a.createElement)("strong",null,e.name),(0,a.createElement)("br",null),(0,a.createElement)("em",null,e.title||e.type||"Representative"),(0,a.createElement)("br",null),e.email))})),(0,a.createElement)("button",{className:"button button-primary continue-btn",onClick:()=>{if(0===r.size)return void alert("Please select at least one representative.");const t=e.filter((e,t)=>r.has(t));n(t)}},"Continue"))},l=({letterTemplate:e,onSend:t,loading:n,success:r})=>{const[s,l]=(0,a.useState)(""),[o,c]=(0,a.useState)(""),[i,d]=(0,a.useState)(e);return(0,a.createElement)("div",{className:"find-my-rep-step step-letter"},(0,a.createElement)("h3",null,"Review and Edit Your Letter"),(0,a.createElement)("div",{className:"letter-fields"},(0,a.createElement)("label",{htmlFor:"sender-name"},"Your Name:"),(0,a.createElement)("input",{type:"text",id:"sender-name",className:"sender-name",value:s,onChange:e=>l(e.target.value),required:!0,disabled:n||!!r}),(0,a.createElement)("label",{htmlFor:"sender-email"},"Your Email:"),(0,a.createElement)("input",{type:"email",id:"sender-email",className:"sender-email",value:o,onChange:e=>c(e.target.value),required:!0,disabled:n||!!r})),(0,a.createElement)("textarea",{className:"letter-content",rows:15,value:i,onChange:e=>d(e.target.value),disabled:n||!!r}),!r&&(0,a.createElement)("button",{className:"button button-primary send-btn",onClick:()=>{s.trim()&&o.trim()&&i.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o)?t(s,o,i):alert("Please enter a valid email address."):alert("Please fill in all fields.")},disabled:n},"Send Letters"),r&&(0,a.createElement)("div",{className:"success-message",style:{display:"block"}},r))},o=({visible:e})=>e?(0,a.createElement)("div",{className:"loading-spinner",style:{display:"block"}},(0,a.createElement)("span",{className:"spinner is-active"})):null,c=({blockId:e})=>{const[t,n]=(0,a.useState)("postcode"),[c,i]=(0,a.useState)([]),[d,m]=(0,a.useState)([]),[u,p]=(0,a.useState)(void 0),[v,E]=(0,a.useState)(""),[y,g]=(0,a.useState)(""),[h,f]=(0,a.useState)(!1),{ajaxUrl:b,nonce:w,letterTemplate:S}=window.findMyRepData;return(0,a.createElement)("div",{className:"find-my-rep-container",id:e},"postcode"===t&&(0,a.createElement)(r,{onFindReps:async e=>{f(!0),E("");try{const t=await fetch(b,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"find_my_rep_get_representatives",nonce:w,postcode:e})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=await t.json();if("object"!=typeof a||null===a||"boolean"!=typeof a.success)throw new Error("Invalid response format");if(a.success)if("object"==typeof a.data&&null!==a.data&&"representatives"in a.data){const e=a.data;i(e.representatives),p(e.geographic_info),n("select")}else{const e=a.data;E(e?.message||"Failed to fetch representatives.")}else{const e=a.data;E(e?.message||"Failed to fetch representatives.")}}catch(e){E("An error occurred. Please try again."),console.error("Error:",e)}finally{f(!1)}},error:v,loading:h}),"select"===t&&(0,a.createElement)(s,{representatives:c,geographicInfo:u,onContinue:e=>{m(e),n("letter")}}),"letter"===t&&(0,a.createElement)(l,{selectedReps:d,letterTemplate:S,onSend:async(e,t,a)=>{f(!0);try{const n=await fetch(b,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"find_my_rep_send_letter",nonce:w,sender_name:e,sender_email:t,letter_content:a,representatives:JSON.stringify(d)})});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const r=await n.json();if("object"!=typeof r||null===r||"boolean"!=typeof r.success)throw new Error("Invalid response format");if(r.success){const e=r.data;let t=e.message;e.errors&&e.errors.length>0&&(t+="\n\nErrors:\n"+e.errors.join("\n")),g(t)}else{const e=r.data;alert(e?.message||"Failed to send letters.")}}catch(e){alert("An error occurred. Please try again."),console.error("Error:",e)}finally{f(!1)}},loading:h,success:y}),(0,a.createElement)(o,{visible:h}))},i=()=>{document.querySelectorAll(".find-my-rep-container").forEach(e=>{const t=e.id;(0,n.H)(e).render((0,a.createElement)(c,{blockId:t}))})};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",i):i()})();