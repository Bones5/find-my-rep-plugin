(()=>{"use strict";var e={338:(e,t,a)=>{var r=a(795);t.H=r.createRoot,r.hydrateRoot},795:e=>{e.exports=window.ReactDOM}},t={};const a=window.React;var r=function a(r){var n=t[r];if(void 0!==n)return n.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,a),s.exports}(338);const n=({onFindReps:e,error:t,loading:r})=>{const[n,s]=(0,a.useState)(""),l=()=>{const t=n.trim();t&&e(t)};return(0,a.createElement)("div",{className:"find-my-rep-step step-postcode"},(0,a.createElement)("h3",null,"Find Your Representatives"),(0,a.createElement)("label",{htmlFor:"postcode-input"},"Enter your postcode:"),(0,a.createElement)("input",{type:"text",id:"postcode-input",className:"postcode-input",placeholder:"e.g. SW1A 1AA",value:n,onChange:e=>s(e.target.value),onKeyPress:e=>{"Enter"===e.key&&l()},disabled:r}),(0,a.createElement)("button",{className:"button button-primary find-reps-btn",onClick:l,disabled:r},"Find Representatives"),t&&(0,a.createElement)("div",{className:"error-message",style:{display:"block"}},t))},s=({representatives:e,geographicInfo:t,onContinue:r})=>{const[n,s]=(0,a.useState)(new Set);return(0,a.createElement)("div",{className:"find-my-rep-step step-select"},(0,a.createElement)("h3",null,"Select Representatives to Contact"),(0,a.createElement)("div",{className:"representatives-list"},e.map((e,r)=>{const l=e.email||`rep-${r}`,o=e.type||e.title||"Representative";return(0,a.createElement)("div",{key:l,className:"representative-item"},(0,a.createElement)("input",{type:"checkbox",id:`rep-${r}`,checked:n.has(r),onChange:()=>(e=>{const t=new Set(n);t.has(e)?t.delete(e):t.add(e),s(t)})(r)}),(0,a.createElement)("label",{htmlFor:`rep-${r}`},(0,a.createElement)("div",{className:"rep-type-title"},o),t&&(0,a.createElement)("div",{className:"rep-geographic-info"},t.area&&(0,a.createElement)("span",{className:"geo-detail"},t.area),t.ward&&(0,a.createElement)("span",{className:"geo-detail"},t.ward),t.westminster_constituency&&(0,a.createElement)("span",{className:"geo-detail"},t.westminster_constituency),t.devolved_constituency&&(0,a.createElement)("span",{className:"geo-detail"},t.devolved_constituency)),(0,a.createElement)("div",{className:"rep-details"},(0,a.createElement)("strong",null,e.name),e.title&&(0,a.createElement)("div",{className:"rep-title-detail"},e.title),(0,a.createElement)("div",{className:"rep-email"},e.email))))})),(0,a.createElement)("button",{className:"button button-primary continue-btn",onClick:()=>{if(0===n.size)return void alert("Please select at least one representative.");const t=e.filter((e,t)=>n.has(t));r(t)}},"Continue"))},l=({letterTemplate:e,onSend:t,loading:r,success:n})=>{const[s,l]=(0,a.useState)(""),[o,c]=(0,a.useState)(""),[i,d]=(0,a.useState)(e);return(0,a.createElement)("div",{className:"find-my-rep-step step-letter"},(0,a.createElement)("h3",null,"Review and Edit Your Letter"),(0,a.createElement)("div",{className:"letter-fields"},(0,a.createElement)("label",{htmlFor:"sender-name"},"Your Name:"),(0,a.createElement)("input",{type:"text",id:"sender-name",className:"sender-name",value:s,onChange:e=>l(e.target.value),required:!0,disabled:r||!!n}),(0,a.createElement)("label",{htmlFor:"sender-email"},"Your Email:"),(0,a.createElement)("input",{type:"email",id:"sender-email",className:"sender-email",value:o,onChange:e=>c(e.target.value),required:!0,disabled:r||!!n})),(0,a.createElement)("textarea",{className:"letter-content",rows:15,value:i,onChange:e=>d(e.target.value),disabled:r||!!n}),!n&&(0,a.createElement)("button",{className:"button button-primary send-btn",onClick:()=>{s.trim()&&o.trim()&&i.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o)?t(s,o,i):alert("Please enter a valid email address."):alert("Please fill in all fields.")},disabled:r},"Send Letters"),n&&(0,a.createElement)("div",{className:"success-message",style:{display:"block"}},n))},o=({visible:e})=>e?(0,a.createElement)("div",{className:"loading-spinner",style:{display:"block"}},(0,a.createElement)("span",{className:"spinner is-active"})):null,c=({blockId:e,perBlockTemplate:t})=>{const[r,c]=(0,a.useState)("postcode"),[i,d]=(0,a.useState)([]),[m,p]=(0,a.useState)([]),[u,v]=(0,a.useState)(void 0),[E,y]=(0,a.useState)(""),[f,g]=(0,a.useState)(""),[h,b]=(0,a.useState)(!1),{ajaxUrl:w,nonce:N,letterTemplate:S}=window.findMyRepData,k=t||S;return(0,a.createElement)("div",{className:"find-my-rep-container",id:e},"postcode"===r&&(0,a.createElement)(n,{onFindReps:async e=>{b(!0),y("");try{const t=await fetch(w,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"find_my_rep_get_representatives",nonce:N,postcode:e})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=await t.json();if("object"!=typeof a||null===a||"boolean"!=typeof a.success)throw new Error("Invalid response format");if(a.success)if("object"==typeof a.data&&null!==a.data&&"representatives"in a.data){const e=a.data;d(e.representatives),v(e.geographic_info),c("select")}else{const e=a.data;y(e?.message||"Failed to fetch representatives.")}else{const e=a.data;y(e?.message||"Failed to fetch representatives.")}}catch(e){y("An error occurred. Please try again."),console.error("Error:",e)}finally{b(!1)}},error:E,loading:h}),"select"===r&&(0,a.createElement)(s,{representatives:i,geographicInfo:u,onContinue:e=>{p(e),c("letter")}}),"letter"===r&&(0,a.createElement)(l,{selectedReps:m,letterTemplate:k,onSend:async(e,t,a)=>{b(!0);try{const r=await fetch(w,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"find_my_rep_send_letter",nonce:N,sender_name:e,sender_email:t,letter_content:a,representatives:JSON.stringify(m)})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const n=await r.json();if("object"!=typeof n||null===n||"boolean"!=typeof n.success)throw new Error("Invalid response format");if(n.success){const e=n.data;let t=e.message;e.errors&&e.errors.length>0&&(t+="\n\nErrors:\n"+e.errors.join("\n")),g(t)}else{const e=n.data;alert(e?.message||"Failed to send letters.")}}catch(e){alert("An error occurred. Please try again."),console.error("Error:",e)}finally{b(!1)}},loading:h,success:f}),(0,a.createElement)(o,{visible:h}))},i=()=>{document.querySelectorAll(".find-my-rep-container").forEach(e=>{const t=e.id,n=e.getAttribute("data-letter-template")||"";(0,r.H)(e).render((0,a.createElement)(c,{blockId:t,perBlockTemplate:n}))})};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",i):i()})();