(()=>{"use strict";var e={338:(e,t,a)=>{var r=a(795);t.H=r.createRoot,r.hydrateRoot},795:e=>{e.exports=window.ReactDOM}},t={};const a=window.React;var r=function a(r){var n=t[r];if(void 0!==n)return n.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,a),s.exports}(338);const n=({onFindReps:e,error:t,loading:r})=>{const[n,s]=(0,a.useState)(""),l=()=>{const t=n.trim();t&&e(t)};return(0,a.createElement)("div",{className:"find-my-rep-step step-postcode"},(0,a.createElement)("h3",null,"Find Your Representatives"),(0,a.createElement)("label",{htmlFor:"postcode-input"},"Enter your postcode:"),(0,a.createElement)("input",{type:"text",id:"postcode-input",className:"postcode-input",placeholder:"e.g. SW1A 1AA",value:n,onChange:e=>s(e.target.value),onKeyPress:e=>{"Enter"===e.key&&l()},disabled:r}),(0,a.createElement)("button",{className:"button button-primary find-reps-btn",onClick:l,disabled:r},"Find Representatives"),t&&(0,a.createElement)("div",{className:"error-message",style:{display:"block"}},t))},s=({representatives:e,onContinue:t})=>{const[r,n]=(0,a.useState)(new Set);return(0,a.createElement)("div",{className:"find-my-rep-step step-select"},(0,a.createElement)("h3",null,"Select Representatives to Contact"),(0,a.createElement)("div",{className:"representatives-list"},e.map((e,t)=>{const s=e.email||`rep-${t}`;return(0,a.createElement)("div",{key:s,className:"representative-item"},(0,a.createElement)("input",{type:"checkbox",id:`rep-${t}`,checked:r.has(t),onChange:()=>(e=>{const t=new Set(r);t.has(e)?t.delete(e):t.add(e),n(t)})(t)}),(0,a.createElement)("label",{htmlFor:`rep-${t}`},(0,a.createElement)("strong",null,e.name),(0,a.createElement)("br",null),(0,a.createElement)("em",null,e.title||e.type||"Representative"),(0,a.createElement)("br",null),e.email))})),(0,a.createElement)("button",{className:"button button-primary continue-btn",onClick:()=>{if(0===r.size)return void alert("Please select at least one representative.");const a=e.filter((e,t)=>r.has(t));t(a)}},"Continue"))},l=({letterTemplate:e,onSend:t,loading:r,success:n})=>{const[s,l]=(0,a.useState)(""),[o,c]=(0,a.useState)(""),[i,d]=(0,a.useState)(e);return(0,a.createElement)("div",{className:"find-my-rep-step step-letter"},(0,a.createElement)("h3",null,"Review and Edit Your Letter"),(0,a.createElement)("div",{className:"letter-fields"},(0,a.createElement)("label",{htmlFor:"sender-name"},"Your Name:"),(0,a.createElement)("input",{type:"text",id:"sender-name",className:"sender-name",value:s,onChange:e=>l(e.target.value),required:!0,disabled:r||!!n}),(0,a.createElement)("label",{htmlFor:"sender-email"},"Your Email:"),(0,a.createElement)("input",{type:"email",id:"sender-email",className:"sender-email",value:o,onChange:e=>c(e.target.value),required:!0,disabled:r||!!n})),(0,a.createElement)("textarea",{className:"letter-content",rows:15,value:i,onChange:e=>d(e.target.value),disabled:r||!!n}),!n&&(0,a.createElement)("button",{className:"button button-primary send-btn",onClick:()=>{s.trim()&&o.trim()&&i.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o)?t(s,o,i):alert("Please enter a valid email address."):alert("Please fill in all fields.")},disabled:r},"Send Letters"),n&&(0,a.createElement)("div",{className:"success-message",style:{display:"block"}},n))},o=({visible:e})=>e?(0,a.createElement)("div",{className:"loading-spinner",style:{display:"block"}},(0,a.createElement)("span",{className:"spinner is-active"})):null,c=({blockId:e})=>{const[t,r]=(0,a.useState)("postcode"),[c,i]=(0,a.useState)([]),[d,m]=(0,a.useState)([]),[u,p]=(0,a.useState)(""),[y,E]=(0,a.useState)(""),[v,b]=(0,a.useState)(!1),{ajaxUrl:f,nonce:h,letterTemplate:w}=window.findMyRepData;return(0,a.createElement)("div",{className:"find-my-rep-container",id:e},"postcode"===t&&(0,a.createElement)(n,{onFindReps:async e=>{b(!0),p("");try{const t=await fetch(f,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"find_my_rep_get_representatives",nonce:h,postcode:e})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=await t.json();if("object"!=typeof a||null===a||"boolean"!=typeof a.success)throw new Error("Invalid response format");if(a.success&&Array.isArray(a.data))i(a.data),r("select");else{const e=a.data;p(e?.message||"Failed to fetch representatives.")}}catch(e){p("An error occurred. Please try again."),console.error("Error:",e)}finally{b(!1)}},error:u,loading:v}),"select"===t&&(0,a.createElement)(s,{representatives:c,onContinue:e=>{m(e),r("letter")}}),"letter"===t&&(0,a.createElement)(l,{selectedReps:d,letterTemplate:w,onSend:async(e,t,a)=>{b(!0);try{const r=await fetch(f,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"find_my_rep_send_letter",nonce:h,sender_name:e,sender_email:t,letter_content:a,representatives:JSON.stringify(d)})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const n=await r.json();if("object"!=typeof n||null===n||"boolean"!=typeof n.success)throw new Error("Invalid response format");if(n.success){const e=n.data;let t=e.message;e.errors&&e.errors.length>0&&(t+="\n\nErrors:\n"+e.errors.join("\n")),E(t)}else{const e=n.data;alert(e?.message||"Failed to send letters.")}}catch(e){alert("An error occurred. Please try again."),console.error("Error:",e)}finally{b(!1)}},loading:v,success:y}),(0,a.createElement)(o,{visible:v}))},i=()=>{document.querySelectorAll(".find-my-rep-container").forEach(e=>{const t=e.id;(0,r.H)(e).render((0,a.createElement)(c,{blockId:t}))})};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",i):i()})();