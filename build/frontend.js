(()=>{"use strict";const e=window.React,t=window.wp.element,n=window.wp.i18n,a=e=>{const t=document.createElement("div");return t.textContent=e,t.innerHTML},r=({councillor:e,index:n,onSelect:r})=>(0,t.createElement)("div",{className:"representative-item councillor-item"},(0,t.createElement)("input",{type:"checkbox",id:`rep-${n}`,onChange:t=>{r(e,t.target.checked)},"data-rep":JSON.stringify(e)}),(0,t.createElement)("label",{htmlFor:`rep-${n}`,dangerouslySetInnerHTML:{__html:`\n                <strong>${a(e.name)}</strong><br>\n                <em>${a(e.party||"Independent")}</em><br>\n                Ward: ${a(e.ward||"N/A")}<br>\n                Council: ${a(e.council||"N/A")}<br>\n                ${e.email?"Email: "+a(e.email):""}\n                ${e.phone?"<br>Phone: "+a(e.phone):""}\n            `}})),l=e=>{const t=document.createElement("div");return t.textContent=e,t.innerHTML},s=({pcc:e,index:n,onSelect:a})=>(0,t.createElement)("div",{className:"representative-item pcc-item"},(0,t.createElement)("input",{type:"checkbox",id:`rep-${n}`,onChange:t=>{a(e,t.target.checked)},"data-rep":JSON.stringify(e)}),(0,t.createElement)("label",{htmlFor:`rep-${n}`,dangerouslySetInnerHTML:{__html:`\n                <strong>${l(e.name)}</strong><br>\n                <em>Police and Crime Commissioner</em><br>\n                Force: ${l(e.force||"N/A")}<br>\n                Area: ${l(e.area||"N/A")}<br>\n                ${e.email?"Email: "+l(e.email):""}\n                ${e.website?'<br>Website: <a href="'+l(e.website)+'" target="_blank">'+l(e.website)+"</a>":""}\n            `}})),i=({data:e,onContinue:a})=>{const[l,i]=(0,t.useState)([]),o=(e,t)=>{i(t?[...l,e]:l.filter(t=>JSON.stringify(t)!==JSON.stringify(e)))};return(0,t.createElement)("div",{className:"find-my-rep-step step-select"},(0,t.createElement)("h3",null,(0,n.__)("Select Representatives to Contact","find-my-rep")),(0,t.createElement)("div",{className:"representatives-list"},(c=e)&&(c.councillors||c.pcc)?[e.councillors&&e.councillors.length>0&&(0,t.createElement)("div",{key:"councillors-section",className:"representatives-section"},(0,t.createElement)("h4",null,(0,n.__)("Local Councillors","find-my-rep")),e.councillors.map((e,n)=>(0,t.createElement)(r,{key:`councillor-${n}`,councillor:e,index:n,onSelect:(e,t)=>o(e,t)}))),e.pcc&&(0,t.createElement)("div",{key:"pcc-section",className:"representatives-section"},(0,t.createElement)("h4",null,(0,n.__)("Police and Crime Commissioner","find-my-rep")),(0,t.createElement)(s,{pcc:e.pcc,index:e.councillors?e.councillors.length:0,onSelect:(e,t)=>o(e,t)}))]:Array.isArray(e)?e.map((e,n)=>(0,t.createElement)("div",{key:`rep-${n}`,className:"representative-item"},(0,t.createElement)("input",{type:"checkbox",id:`rep-${n}`,onChange:t=>o(e,t.target.checked),"data-rep":JSON.stringify(e)}),(0,t.createElement)("label",{htmlFor:`rep-${n}`,dangerouslySetInnerHTML:{__html:`\n                        <strong>${e.name}</strong><br>\n                        <em>${e.title||e.type||"Representative"}</em><br>\n                        ${e.email||""}\n                    `}}))):null),(0,t.createElement)("button",{className:"button button-primary continue-btn",onClick:()=>{0!==l.length?a(l):alert((0,n.__)("Please select at least one representative.","find-my-rep"))}},(0,n.__)("Continue","find-my-rep")));var c},o=({blockId:e})=>{const[a,r]=(0,t.useState)("postcode"),[l,s]=(0,t.useState)(""),[o,c]=(0,t.useState)(null),[m,d]=(0,t.useState)([]),[p,u]=(0,t.useState)(""),[y,f]=(0,t.useState)(""),[_,E]=(0,t.useState)(""),[h,b]=(0,t.useState)(!1),[g,v]=(0,t.useState)(""),[w,N]=(0,t.useState)(""),S=e=>{v(e)};return(0,t.createElement)("div",{className:"find-my-rep-container",id:e},"postcode"===a&&(0,t.createElement)("div",{className:"find-my-rep-step step-postcode"},(0,t.createElement)("h3",null,(0,n.__)("Find Your Representatives","find-my-rep")),(0,t.createElement)("label",{htmlFor:"postcode-input"},(0,n.__)("Enter your postcode:","find-my-rep")),(0,t.createElement)("input",{type:"text",id:"postcode-input",className:"postcode-input",placeholder:"e.g. SW1A 1AA",value:l,onChange:e=>s(e.target.value)}),(0,t.createElement)("button",{className:"button button-primary find-reps-btn",onClick:async()=>{if(l.trim()){b(!0),v("");try{const e=await fetch(window.findMyRepData.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"find_my_rep_get_representatives",nonce:window.findMyRepData.nonce,postcode:l})});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();if("object"!=typeof t||null===t||"boolean"!=typeof t.success)throw new Error("Invalid response format");if(t.success&&t.data)c(t.data),r("select");else{const e=t.data&&t.data.message?t.data.message:(0,n.__)("Failed to fetch representatives.","find-my-rep");S(e)}}catch(e){S((0,n.__)("An error occurred. Please try again.","find-my-rep")),console.error("Error:",e)}finally{b(!1)}}else S((0,n.__)("Please enter a postcode.","find-my-rep"))}},(0,n.__)("Find Representatives","find-my-rep")),g&&(0,t.createElement)("div",{className:"error-message",style:{display:"block"}},g)),"select"===a&&o&&(0,t.createElement)(i,{data:o,onContinue:e=>{d(e),E(window.findMyRepData.letterTemplate),r("letter")}}),"letter"===a&&(0,t.createElement)("div",{className:"find-my-rep-step step-letter"},(0,t.createElement)("h3",null,(0,n.__)("Review and Edit Your Letter","find-my-rep")),(0,t.createElement)("div",{className:"letter-fields"},(0,t.createElement)("label",{htmlFor:"sender-name"},(0,n.__)("Your Name:","find-my-rep")),(0,t.createElement)("input",{type:"text",id:"sender-name",className:"sender-name",required:!0,value:p,onChange:e=>u(e.target.value)}),(0,t.createElement)("label",{htmlFor:"sender-email"},(0,n.__)("Your Email:","find-my-rep")),(0,t.createElement)("input",{type:"email",id:"sender-email",className:"sender-email",required:!0,value:y,onChange:e=>f(e.target.value)})),(0,t.createElement)("textarea",{className:"letter-content",rows:15,value:_,onChange:e=>E(e.target.value)}),!w&&(0,t.createElement)("button",{className:"button button-primary send-btn",onClick:async()=>{if(p.trim()&&y.trim()&&_.trim())if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(y)){b(!0);try{const e=await fetch(window.findMyRepData.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"find_my_rep_send_letter",nonce:window.findMyRepData.nonce,sender_name:p,sender_email:y,letter_content:_,representatives:JSON.stringify(m)})});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();if("object"!=typeof t||null===t||"boolean"!=typeof t.success)throw new Error("Invalid response format");if(t.success&&t.data)N(t.data.message);else{const e=t.data&&t.data.message?t.data.message:(0,n.__)("Failed to send letters.","find-my-rep");alert(e)}}catch(e){alert((0,n.__)("An error occurred. Please try again.","find-my-rep")),console.error("Error:",e)}finally{b(!1)}}else alert((0,n.__)("Please enter a valid email address.","find-my-rep"));else alert((0,n.__)("Please fill in all fields.","find-my-rep"))}},(0,n.__)("Send Letters","find-my-rep")),w&&(0,t.createElement)("div",{className:"success-message",style:{display:"block"}},w)),h&&(0,t.createElement)("div",{className:"loading-spinner",style:{display:"block"}},(0,t.createElement)("span",{className:"spinner is-active"})))};function c(){document.querySelectorAll(".find-my-rep-container").forEach(n=>{const a=n.id||`block-${Date.now()}`;n.innerHTML="",(0,t.render)((0,e.createElement)(o,{blockId:a}),n)})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",c):c()})();