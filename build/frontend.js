!function(){"use strict";function e(){document.querySelectorAll(".find-my-rep-container").forEach(e=>{!function(e){const t=e.querySelector(".postcode-input"),n=e.querySelector(".find-reps-btn"),r=e.querySelector(".continue-btn"),a=e.querySelector(".send-btn"),o=e.querySelector(".step-postcode"),s=e.querySelector(".step-select"),l=e.querySelector(".step-letter"),c=e.querySelector(".representatives-list"),i=e.querySelector(".letter-content"),d=e.querySelector(".error-message"),p=e.querySelector(".success-message"),u=e.querySelector(".loading-spinner");let y=[];function m(e){o.style.display="none",s.style.display="none",l.style.display="none","postcode"===e?o.style.display="block":"select"===e?s.style.display="block":"letter"===e&&(l.style.display="block")}function f(e){u.style.display=e?"block":"none"}function h(e){d.textContent=e,d.style.display="block"}function S(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}n.addEventListener("click",function(){const e=t.value.trim();e?(f(!0),d.style.display="none",fetch(findMyRepData.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"find_my_rep_get_representatives",nonce:findMyRepData.nonce,postcode:e})}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>{if(f(!1),"object"!=typeof e||null===e||"boolean"!=typeof e.success)throw new Error("Invalid response format");var t;e.success&&e.data?(t=e.data,c.innerHTML="",Array.isArray(t)||(t=[t]),t.forEach((e,t)=>{const n=document.createElement("div");n.className="representative-item";const r=document.createElement("input");r.type="checkbox",r.id="rep-"+t,r.setAttribute("data-rep",JSON.stringify(e));const a=document.createElement("label");a.htmlFor="rep-"+t,a.innerHTML=`\n                    <strong>${S(e.name)}</strong><br>\n                    <em>${S(e.title||e.type||"Representative")}</em><br>\n                    ${e.email?S(e.email):""}\n                `,n.appendChild(r),n.appendChild(a),c.appendChild(n)}),m("select")):h(e.data&&e.data.message?e.data.message:"Failed to fetch representatives.")}).catch(e=>{f(!1),h("An error occurred. Please try again."),console.error("Error:",e)})):h("Please enter a postcode.")}),r.addEventListener("click",function(){const e=c.querySelectorAll('input[type="checkbox"]:checked');0!==e.length?(y=[],e.forEach(e=>{const t=JSON.parse(e.getAttribute("data-rep"));y.push(t)}),i.value=findMyRepData.letterTemplate,m("letter")):alert("Please select at least one representative.")}),a.addEventListener("click",function(){const t=e.querySelector(".sender-name").value.trim(),n=e.querySelector(".sender-email").value.trim(),r=i.value.trim();t&&n&&r?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)?(f(!0),fetch(findMyRepData.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"find_my_rep_send_letter",nonce:findMyRepData.nonce,sender_name:t,sender_email:n,letter_content:r,representatives:JSON.stringify(y)})}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>{if(f(!1),"object"!=typeof e||null===e||"boolean"!=typeof e.success)throw new Error("Invalid response format");if(e.success&&e.data){if(p.textContent=e.data.message,p.style.display="block",a.style.display="none",e.data.errors&&e.data.errors.length>0){const t=document.createElement("ul");e.data.errors.forEach(e=>{const n=document.createElement("li");n.textContent=e,t.appendChild(n)}),p.appendChild(t)}}else{const t=e.data&&e.data.message?e.data.message:"Failed to send letters.";alert(t)}}).catch(e=>{f(!1),alert("An error occurred. Please try again."),console.error("Error:",e)})):alert("Please enter a valid email address."):alert("Please fill in all fields.")})}(e)})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}();